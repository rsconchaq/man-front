<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Gestión de Aulas</h4>
                <div class="flex-shrink-0">
                    <button class="btn btn-primary btn-sm" 
                            (click)="abrirModalNuevo()"
                            [disabled]="loading">
                        <i class="ri-add-line me-1"></i>
                        Nueva Aula
                    </button>
                </div>
            </div>
            
            <div class="card-body">
                <!-- Controles de tabla -->
                <div class="d-flex justify-content-end mb-3">
                    <div class="d-flex align-items-center gap-2">
                       
                    </div>
                </div>

                <!-- Tabla de aulas con DataTables -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover w-100" 
                           datatable 
                           [dtOptions]="dtOptions" 
                           [dtTrigger]="dtTrigger"
                           style="width: 100%;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Local</th>
                                <th>Descripción Aula</th>
                                <th>Descripción</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargan vía DataTables con Ajax -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal template para NgbModal -->
<ng-template #aulaModal>
    <div class="modal-header">
        <h5 class="modal-title">{{ editMode ? 'Editar Aula' : 'Nueva Aula' }}</h5>
        <button type="button" class="btn-close" (click)="cerrarModal()" aria-label="Close"></button>
    </div>
    <form [formGroup]="aulaForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
            <!-- Local -->
            <div class="mb-3">
                <label for="idLocal" class="form-label">Local <span class="text-danger">*</span></label>
                <select id="idLocal" 
                        class="form-select" 
                        formControlName="idLocal"
                        [class.is-invalid]="isFieldInvalid('idLocal')">
                    <option value="">Seleccione un local</option>
                    <option *ngFor="let local of locales" [value]="local.id">
                        {{ local.descripcion }}
                    </option>
                </select>
                <div *ngIf="isFieldInvalid('idLocal')" class="invalid-feedback">
                    <span *ngIf="aulaForm.get('idLocal')?.errors?.['required']">El local es requerido</span>
                </div>
            </div>

            <!-- Descripción Aula -->
            <div class="mb-3">
                <label for="descripcionAula" class="form-label">Descripción Aula <span class="text-danger">*</span></label>
                <input type="text" 
                       id="descripcionAula"
                       class="form-control" 
                       formControlName="descripcionAula"
                       [class.is-invalid]="isFieldInvalid('descripcionAula')"
                       placeholder="Ingrese descripción del aula (ej: Aula 101)">
                <div *ngIf="isFieldInvalid('descripcionAula')" class="invalid-feedback">
                    <span *ngIf="aulaForm.get('descripcionAula')?.errors?.['required']">La descripción del aula es requerida</span>
                    <span *ngIf="aulaForm.get('descripcionAula')?.errors?.['minlength']">La descripción debe tener al menos 2 caracteres</span>
                    <span *ngIf="aulaForm.get('descripcionAula')?.errors?.['maxlength']">La descripción no puede exceder 100 caracteres</span>
                </div>
            </div>

            <!-- Descripción -->
            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción <span class="text-danger">*</span></label>
                <textarea id="descripcion" 
                          class="form-control" 
                          formControlName="descripcion"
                          [class.is-invalid]="isFieldInvalid('descripcion')"
                          placeholder="Ingrese descripción detallada del aula"
                          rows="3"></textarea>
                <div *ngIf="isFieldInvalid('descripcion')" class="invalid-feedback">
                    <span *ngIf="aulaForm.get('descripcion')?.errors?.['required']">La descripción es requerida</span>
                    <span *ngIf="aulaForm.get('descripcion')?.errors?.['maxlength']">La descripción no puede exceder 255 caracteres</span>
                </div>
            </div>

            <!-- Estado -->
            <div class="mb-3">
                <label for="estado" class="form-label">Estado</label>
                <select id="estado" 
                        class="form-select" 
                        formControlName="activo"
                        [class.is-invalid]="isFieldInvalid('activo')">
                    <option value="">Seleccione estado</option>
                    <option [value]="true">ACTIVO</option>
                    <option [value]="false">INACTIVO</option>
                </select>
                <div *ngIf="isFieldInvalid('activo')" class="invalid-feedback">
                    El estado es requerido
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="cerrarModal()">
                Cancelar
            </button>
            <button type="button" 
                    class="btn btn-primary"
                    [disabled]="aulaForm.invalid || loading"
                    (click)="onSubmit()">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
                {{ editMode ? 'Actualizar' : 'Guardar' }}
            </button>
        </div>
    </form>
</ng-template>