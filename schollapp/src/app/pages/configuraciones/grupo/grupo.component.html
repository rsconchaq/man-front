<!-- Breadcrumbs -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
      <h4 class="mb-sm-0">GRUPOS</h4>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item">Configuraciones</li>
          <li class="breadcrumb-item active">Grupos</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Lista de Grupos</h4>
        <div class="flex-shrink-0">
          <button class="btn btn-success btn-sm" 
                  (click)="abrirModalNuevo()"
                  [disabled]="loading">
            <i class="ri-add-line me-1"></i>
            Agregar Nuevo
          </button>
        </div>
      </div>
      
      <div class="card-body">
        <!-- Tabla de grupos con DataTables -->
        <div class="table-responsive">
          <table id="grupoTable"
                 class="table table-striped table-hover w-100" 
                 datatable 
                 [dtOptions]="dtOptions" 
                 [dtTrigger]="dtTrigger"
                 style="width: 100%;">
            <thead>
              <tr>
                <th>Descripción</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Los datos se cargan vía DataTables -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal template para NgbModal -->
<ng-template #grupoModal>
  <div class="modal-header">
    <h5 class="modal-title">{{ editMode ? 'Editar Grupo' : 'Nuevo Grupo' }}</h5>
    <button type="button" class="btn-close" (click)="cerrarModal()" aria-label="Close"></button>
  </div>
  <form [formGroup]="grupoForm" (ngSubmit)="onSubmit()">
    <div class="modal-body">
      <!-- Descripción -->
       <div class="mb-3">
        <label for="edad1" class="form-label">Edad Desde <span class="text-danger">*</span></label>
        <input type="number" 
               id="edad1"
               class="form-control" 
               formControlName="edad1"
               [class.is-invalid]="isFieldInvalid('edad1')"
               placeholder="Ingrese edad desde"
               (focusout)="validarRangoEdades()">
        <div *ngIf="isFieldInvalid('edad1')" class="invalid-feedback">
          <span *ngIf="grupoForm.get('edad1')?.errors?.['required']">La edad desde es requerida</span>
          <span *ngIf="grupoForm.get('edad1')?.errors?.['min']">La edad desde debe ser al menos 0</span>
          <span *ngIf="grupoForm.get('edad1')?.errors?.['max']">La edad desde no puede exceder 100</span>
        </div>
      </div>
      <div class="mb-3">
        <label for="edad2" class="form-label">Edad Hasta <span class="text-danger">*</span></label>
        <input type="number" 
               id="edad2"
               class="form-control" 
               formControlName="edad2"
               [class.is-invalid]="isFieldInvalid('edad2')"
               placeholder="Ingrese edad hasta"
               (focusout)="validarRangoEdades()">
        <div *ngIf="isFieldInvalid('edad2')" class="invalid-feedback">
          <span *ngIf="grupoForm.get('edad2')?.errors?.['required']">La edad hasta es requerida</span>
          <span *ngIf="grupoForm.get('edad2')?.errors?.['min']">La edad hasta debe ser al menos 0</span>
          <span *ngIf="grupoForm.get('edad2')?.errors?.['max']">La edad hasta no puede exceder 100</span>
          <span *ngIf="validarRangoEdades()">La edad hasta debe ser mayor o igual a la edad desde</span>
        </div>
      </div>
      <div class="mb-3">
        <label for="descripcionGrupo" class="form-label">Descripción <span class="text-danger">*</span></label>
        <input type="text" 
               id="descripcionGrupo"
               class="form-control" 
               formControlName="descripcionGrupo"
               [class.is-invalid]="isFieldInvalid('descripcionGrupo')"
               placeholder="Ingrese descripción del grupo">
        <div *ngIf="isFieldInvalid('descripcionGrupo')" class="invalid-feedback">
          <span *ngIf="grupoForm.get('descripcionGrupo')?.errors?.['required']">La descripción es requerida</span>
          <span *ngIf="grupoForm.get('descripcionGrupo')?.errors?.['minlength']">La descripción debe tener al menos 2 caracteres</span>
          <span *ngIf="grupoForm.get('descripcionGrupo')?.errors?.['maxlength']">La descripción no puede exceder 100 caracteres</span>
        </div>
      </div>

      <!-- Estado -->
      <div class="mb-3">
        <label for="estado" class="form-label">Estado</label>
        <select id="estado" 
                class="form-select" 
                formControlName="activo"
                [class.is-invalid]="isFieldInvalid('activo')">
          <option value="">Seleccione estado</option>
          <option [value]="true">ACTIVO</option>
          <option [value]="false">INACTIVO</option>
        </select>
        <div *ngIf="isFieldInvalid('activo')" class="invalid-feedback">
          El estado es requerido
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="cerrarModal()">
        Cancelar
      </button>
      <button type="button" 
              class="btn btn-primary"
              [disabled]="grupoForm.invalid || loading"
              (click)="onSubmit()">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
        {{ editMode ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </form>
</ng-template>